# 爬虫基础
了解一些基础知识，如 HTTP 原理、网页的基础知识、爬虫的基本原理、Cookies 的基本原理等。

## HTTP 基本原理

URL 的开头会有 http 或 https，这个就是访问资源需要的协议类型，有时还会看到 ftp、sftp、smb（协议类型） 开头的 URL

- HTTP（Hyper Text Transfer Protocol，超文本传输协议），用于从网络传输超文本数据到本地浏览器的传送协议，它能保证传送高效而准确地传送超文本文档。

- HTTPS（Hyper Text Transfer Protocol over Secure Socket Layer），是以安全为目标的 HTTP 通道。

HTTPS 的安全基础是 SSL，因此通过它传输的内容都是经过 SSL 加密的，它的主要作用可以分为两种：
- 建立一个信息安全通道，来保证数据传输的安全。 
- 确认网站的真实性，凡是使用了 https 的网站，都可以通过点击浏览器地址栏的锁头标志来查看网站认证之后的真实信息，也可以通过 CA 机构颁发的安全签章来查询。

如果要爬取这样的站点，就需要设置忽略证书的选项，否则会提示 SSL 链接错误。

## 请求
由客户端向服务端发出，可以分为 4 部分内容：
- 请求方法（Request Method）
- 请求的网址（Request URL）
- 请求头（Request Headers）
- 请求体（Request Body）

**请求方法** 

常见的请求方法有两种：GET 和 POST。 
- 在浏览器中直接输入 URL 并回车，这便发起了一个 GET 请求，请求的参数会直接包含到 URL 里。
- POST 请求大多在表单提交时发起。比如，对于一个登录表单，通常会发起一个 POST 请求，其数据通常以表单的形式传输，而不会体现在 URL 中。 

> GET 请求提交的数据最多只有 1024 字节，而 POST 方式没有限制。 
> 
> 一般来说，登录时，需要提交用户名和密码，其中包含了敏感信息，最好以 POST 方式发送。上传文件时，由于文件内容比较大，也会选用 POST 方式。

其它请求方法（HEAD、PUT、DELETE、OPTIONS、CONNECT、TRACE）等。
- HEAD	类似于 GET 请求，只不过返回的响应中没有具体的内容，用于获取报头 
- PUT	从客户端向服务器传送的数据取代指定文档中的内容 
- DELETE	请求服务器删除指定的页面 
- CONNECT	把服务器当作跳板，让服务器代替客户端访问其他网页 
- OPTIONS	允许客户端查看服务器的性能 
- TRACE	回显服务器收到的请求，主要用于测试或诊断

**请求头**

request headers，用来说明服务器要使用的附加信息，比较重要的信息有 Cookie、Referer、User-Agent 等。
- Accept：请求报头域，用于指定客户端可接受哪些类型的信息。 
- Accept-Language：指定客户端可接受的语言类型。 
- Accept-Encoding：指定客户端可接受的内容编码。 
- Host：用于指定请求资源的主机 IP 和端口号，其内容为请求 URL 的原始服务器或网关的位置。从 HTTP 1.1 版本开始，请求必须包含此内容。
- Cookie：也常用复数形式 Cookies，这是网站为了辨别用户进行会话跟踪而存储在用户本地的数据。它的主要功能是维持当前访问会话。例如，我们输入用户名和密码成功登录某个网站后，服务器会用会话保存登录状态信息，后面我们每次刷新或请求该站点的其他页面时，会发现都是登录状态，这就是 Cookies 的功劳。Cookies 里有信息标识了我们所对应的服务器的会话，每次浏览器在请求该站点的页面时，都会在请求头中加上 Cookies 并将其发送给服务器，服务器通过 Cookies 识别出是我们自己，并且查出当前状态是登录状态，所以返回结果就是登录之后才能看到的网页内容。 
- Referer：此内容用来标识这个请求是从哪个页面发过来的，服务器可以拿到这一信息并做相应的处理，如做来源统计、防盗链处理等。 
- User-Agent：简称 UA，它是一个特殊的字符串头，可以使服务器识别客户使用的操作系统及版本、浏览器及版本等信息。在做爬虫时加上此信息，可以伪装为浏览器；如果不加，很可能会被识别出为爬虫。 
- Content-Type：也叫互联网媒体类型（Internet Media Type）或者 MIME 类型，在 HTTP 协议消息头中，它用来表示具体请求中的媒体类型信息。例如，text/html 代表 HTML 格式，image/gif 代表 GIF 图片，application/json 代表 JSON 类型，更多对应关系可以查看此对照表：http://tool.oschina.net/commons。

> 请求头是请求的重要组成部分，在写爬虫时，大部分情况下都需要设定请求头。
 
**请求体**

请求体（体现在*From Data*）一般承载的内容是 POST 请求中的表单数据，而对于 GET 请求，请求体则为空。

例如，这里我登录 GitHub 时捕获到的请求和响应如图 2-7 所示。

## 响应

Response，由服务端返回给客户端，可以分为三部分： 响应状态码（Response Status Code）、响应头（Response Headers）和响应体（Response Body）。

**响应状态码**

表示服务器的响应状态，如 **200 代表服务器正常响应，404 代表页面未找到，500 代表服务器内部发生错误**。

**响应头**

响应头包含了服务器对请求的应答信息，如 Content-Type、Server、Set-Cookie 等。

- Date：标识响应产生的时间。 
- Last-Modified：指定资源的最后修改时间。 
- Content-Encoding：指定响应内容的编码。 
- Server：包含服务器的信息，比如名称、版本号等。 
- Content-Type：文档类型，指定返回的数据类型是什么，如 text/html 代表返回 HTML 文档，application/x-javascript 则代表返回 JavaScript 文件，image/jpeg 则代表返回图片。 
- Set-Cookie：设置 Cookies。响应头中的 Set-Cookie 告诉浏览器需要将此内容放在 Cookies 中，下次请求携带 Cookies 请求。 
- Expires：指定响应的过期时间，可以使代理服务器或浏览器将加载的内容更新到缓存中。如果再次访问时，就可以直接从缓存中加载，降低服务器负载，缩短加载时间。 

**响应体**

**最重要的当属响应体的内容**。响应的正文数据都在响应体中，比如请求网页时，它的响应体就是网页的 HTML 代码；请求一张图片时，它的响应体就是图片的二进制数据。

**爬虫请求网页后，要解析的内容就是响应体**。

> 在浏览器开发者工具中点击 Preview，就可以看到网页的源代码，也就是响应体的内容，它是解析的目标。 
> 
> 在做爬虫时，我们主要通过响应体得到网页的源代码、JSON 数据等，然后从中做相应内容的提取。 

# Web 网页基础